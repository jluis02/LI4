@using DataLayer.Watches
@using DataLayer.Leilao
@inject NavigationManager NavigationManager
@inject ILeilaoRepository LeilaoRepo

<div class="comp">
    <a @onclick="NavigateToPage">
        @if (watchInfo != null)
        {
            <div class="watch shadow">
                @if (watchInfo.Imagem != null && watchInfo.Imagem.Length > 0)
                {
                    string imageBase64 = Convert.ToBase64String(watchInfo.Imagem);
                    <img src="data:image/jpeg;base64,@imageBase64" class="watch-img-top" alt="@watchInfo.Id">
                }
                else
                {
                    <div class="placeholder-image">Imagem não disponível</div>
                }
                <div class="card-body">
                    <h5 class="watch-title">@watchInfo.Marca @watchInfo.Modelo</h5>
                    <h6 class="watch-subtitle mb-3 text-muted">
                        <span class="oi oi-align-left"></span>
                        @watchInfo.Descricao
                    </h6>
                    <p>Licitação Atual: <strong>@leilao.LicitacaoAtual €</strong></p>
                </div>
            </div>
        }
    </a>
</div>

@code {
    [Parameter, EditorRequired]
    public LeilaoModel leilao { get; set; } = default!;

    private WatchModel watchInfo = null!;

    protected override async Task OnParametersSetAsync()
    {
        try
        {
            // Use a função FindWatch para obter as informações do relógio correspondente ao leilão
            watchInfo = await LeilaoRepo.FindWatch(leilao.Id);

            Console.WriteLine("--------------------------------------------------------------");

            if (watchInfo != null)
            {
                Console.WriteLine($"ID do relógio: {watchInfo.Id}");
                Console.WriteLine($"Modelo: {watchInfo.Modelo}");
                Console.WriteLine($"Imagem disponível: {watchInfo.Imagem != null && watchInfo.Imagem.Length > 0}");

                if (watchInfo.Imagem != null && watchInfo.Imagem.Length > 0)
                {
                    string imageBase64 = Convert.ToBase64String(watchInfo.Imagem);
                }
                else
                {
                    Console.WriteLine("Imagem está vazia ou não inicializada.");
                }
            }
            else
            {
                Console.WriteLine("Objeto WatchInfo é nulo.");
            }

            Console.WriteLine("--------------------------------------------------------------");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Erro ao recuperar informações do relógio: {ex.Message}");
        }
    }

    private void NavigateToPage()
    {
        NavigationManager.NavigateTo($"/leilao/{leilao.Id}");
    }
}